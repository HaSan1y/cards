(()=>{"use strict";const t=SimpleWebAuthnBrowser;console.log("Script loaded"),document.querySelector("[data-email]");const e=document.querySelector("[data-modal]"),o=document.querySelector("[data-close]");document.addEventListener("DOMContentLoaded",(function(){console.log("DOM fully loaded");const e=document.getElementById("authForm"),o=document.getElementById("submitButton");console.log("Form element:",e),console.log("Submit button:",o),o?o.addEventListener("click",(async e=>{e.preventDefault(),console.log("Form submitted"),o.hasAttribute("data-login")?(console.log("Login attempt"),await async function(){console.log("Login function called");try{const e=document.getElementById("username").value;if(console.log("Attempting to log in with username:",e),!e)return void a("Please enter a username");const o=await fetch(`${n}/init-auth?username=${e}`,{credentials:"include"});if(!o.ok){const t=await o.json();throw new Error(t.error||`HTTP error! status: ${o.status}`)}const i=await o.json(),r=await(0,t.startAuthentication)(i),l=await fetch(`${n}/verify-auth`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await l.json();if(!l.ok)throw new Error(s.error||"Verification failed");s.verified?a(`Successfully logged in ${e}`):a("Failed to log in")}catch(t){console.error("Login error:",t)}}()):o.hasAttribute("data-signup")?(console.log("Signup attempt"),await async function(){console.log("Signup function called");try{const e=document.querySelector("[data-email]").value;console.log("Registering with email:",e);const o=await fetch(`${n}/init-register?email=${e}`,{credentials:"include"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const i=await o.json();console.log("Server response:",i);const r=await(0,t.startRegistration)(i);console.log("Registration JSON:",r);const l=await fetch(`${n}/verify-register`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await l.json();l.ok||a(s.error),s.verified?a(`Successfully registered ${e}`):a("Failed to register")}catch(t){console.error("Signup error:",t)}}()):console.log("Button has neither data-login nor data-signup attribute")})):console.error("Form element not found")})),o.addEventListener("click",(()=>e.close()));const n="https://db-2-cards.vercel.app"===window.location.origin?"https://db-2-cards.vercel.app/api":"http://localhost:3000"===window.location.origin?"http://localhost:3000/api":"https://elegant-bubblegum-a62895.netlify.app"===window.location.origin?"https://elegant-bubblegum-a62895.netlify.app/.netlify/functions/api":"http://localhost:3000/api";function a(t){e.querySelector("[data-content]").innerText=t,e.showModal()}})();